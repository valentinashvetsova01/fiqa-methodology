<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intent-Aware Retrieval for Financial QA</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        const MethodologyDiagram = () => {
            const [selectedPipeline, setSelectedPipeline] = useState(null);

            const pipelineDetails = {
                advice: {
                    title: "ADVICE-SEEKING Pipeline",
                    example: '"Should I invest in index funds for retirement?"',
                    color: "#22c55e",
                    steps: [
                        { name: "Argument Quality Scoring", tech: "Custom scorer", detail: "Discourse markers: 'because', 'therefore', 'for example'\nClaim-Premise-Evidence detection" },
                        { name: "Evidence Detection", tech: "Regex + NLP patterns", detail: "Numerical data, citations, personal experience markers" },
                        { name: "Cross-Encoder Re-rank", tech: "BGE-reranker-base", detail: "Final = Œª‚ÇÅ¬∑CE + Œª‚ÇÇ¬∑ArgQuality + Œª‚ÇÉ¬∑DiscourseScore" }
                    ]
                },
                comparison: {
                    title: "COMPARISON Pipeline",
                    example: '"What is the difference between ETFs and mutual funds?"',
                    color: "#f59e0b",
                    steps: [
                        { name: "Entity Extraction", tech: "SpaCy + regex", detail: "Extract Entity_A, Entity_B from 'X vs Y' patterns" },
                        { name: "Dual-Entity Filter", tech: "Hard constraint", detail: "Document MUST mention BOTH entities" },
                        { name: "Comparative Scoring", tech: "Custom financial scorer", detail: "Coverage balance: min(A,B)/max(A,B)\nComparative language + Aspect coverage" }
                    ]
                },
                definition: {
                    title: "DEFINITION Pipeline",
                    example: '"What is a Roth IRA?"',
                    color: "#3b82f6",
                    steps: [
                        { name: "Entity-Centric Query", tech: "NER extraction", detail: "Extract main entity from query" },
                        { name: "Definition Patterns", tech: "Regex matching", detail: "'X is a...', 'X refers to...', 'X means...'" },
                        { name: "Entity Prominence", tech: "Position scoring", detail: "Earlier position = higher score" }
                    ]
                },
                explanation_why: {
                    title: "EXPLANATION_WHY Pipeline",
                    example: '"Why do stock prices drop after earnings?"',
                    color: "#ec4899",
                    steps: [
                        { name: "HyDE Expansion", tech: "LLM generation", detail: "Prompt: 'Explain why {topic} happens in finance...'\nUse embedding of generated answer for retrieval boost" },
                        { name: "Causal Marker Boost", tech: "Soft scoring", detail: "+score for: 'because', 'due to', 'caused by',\n'driven by', 'as a result', 'the reason is'" },
                        { name: "Cross-Encoder Re-rank", tech: "BGE-reranker-base", detail: "Final = 0.7√óCE + 0.3√óCausalMarkerDensity\n(soft boost, NOT hard filter)" }
                    ]
                },
                explanation_how: {
                    title: "EXPLANATION_HOW Pipeline",
                    example: '"How do I calculate compound interest?"',
                    color: "#8b5cf6",
                    steps: [
                        { name: "HyDE Expansion", tech: "LLM generation", detail: "Prompt: 'Write step-by-step instructions for {action}...'\nUse embedding for retrieval boost" },
                        { name: "Procedural Structure Boost", tech: "Soft scoring", detail: "+score for: numbered lists, 'step 1/2/3',\n'first...then...finally', imperative verbs" },
                        { name: "Cross-Encoder Re-rank", tech: "BGE-reranker-base", detail: "Final = 0.7√óCE + 0.2√óProceduralScore + 0.1√óFormulaPresence" }
                    ]
                }
            };

            const Box = ({ children, className }) => (
                <div className={`rounded-lg p-4 shadow-md ${className}`}>{children}</div>
            );

            const Arrow = () => (
                <div className="flex justify-center my-2">
                    <svg className="w-6 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 14l-7 7m0 0l-7-7m7 7V3" />
                    </svg>
                </div>
            );

            const PipelineCard = ({ id, title, emoji, color, isSelected }) => (
                <div 
                    onClick={() => setSelectedPipeline(isSelected ? null : id)}
                    className={`cursor-pointer p-3 rounded-lg border-2 transition-all duration-300 ${isSelected ? 'shadow-lg scale-105' : 'hover:shadow-md'}`}
                    style={{ borderColor: color, backgroundColor: isSelected ? `${color}20` : 'white' }}
                >
                    <div className="text-center font-bold text-sm" style={{ color }}>{emoji} {title}</div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-6">
                    <div className="max-w-5xl mx-auto">
                        <h1 className="text-3xl font-bold text-center text-slate-800 mb-2">
                            Intent-Aware Retrieval for Financial QA
                        </h1>
                        <p className="text-center text-slate-500 mb-8">Method Overview ‚Äî Click pipelines for details</p>

                        <div className="bg-white rounded-2xl shadow-xl p-8">
                            <Box className="bg-blue-50 border-2 border-blue-400 max-w-md mx-auto text-center">
                                <div className="text-sm font-semibold text-blue-600">üì• USER QUERY</div>
                                <div className="text-slate-600 text-sm italic mt-1">"Should I invest in ETFs or mutual funds?"</div>
                            </Box>

                            <Arrow />

                            <Box className="bg-amber-50 border-2 border-amber-400 max-w-lg mx-auto text-center">
                                <div className="text-sm font-semibold text-amber-700">‚ö° UNIVERSAL QUERY EXPANSION</div>
                                <div className="text-slate-600 text-xs mt-1">Query2Doc: LLM generates pseudo-document</div>
                            </Box>

                            <Arrow />

                            <Box className="bg-indigo-50 border-2 border-indigo-400 max-w-lg mx-auto text-center">
                                <div className="text-sm font-semibold text-indigo-700">üîç FIRST-STAGE RETRIEVAL (shared)</div>
                                <div className="text-slate-600 text-xs mt-1">BM25 + Dense ‚Üí RRF ‚Üí Top-50 candidates</div>
                            </Box>

                            <Arrow />

                            <Box className="bg-orange-50 border-2 border-orange-500 max-w-md mx-auto text-center">
                                <div className="text-sm font-semibold text-orange-700">üéØ INTENT CLASSIFIER</div>
                                <div className="text-slate-600 text-xs mt-1">DistilBERT fine-tuned on FiQA</div>
                            </Box>

                            <Arrow />

                            {/* Row 1: 3 pipelines */}
                            <div className="grid grid-cols-3 gap-3 mb-3">
                                <PipelineCard id="advice" title="ADVICE" emoji="üí°" color="#22c55e" isSelected={selectedPipeline === 'advice'} />
                                <PipelineCard id="comparison" title="COMPARISON" emoji="‚öñÔ∏è" color="#f59e0b" isSelected={selectedPipeline === 'comparison'} />
                                <PipelineCard id="definition" title="DEFINITION" emoji="üìñ" color="#3b82f6" isSelected={selectedPipeline === 'definition'} />
                            </div>
                            
                            {/* Row 2: 2 explanation pipelines */}
                            <div className="grid grid-cols-2 gap-3 mb-6 max-w-md mx-auto">
                                <PipelineCard id="explanation_why" title="EXPL_WHY" emoji="‚ùì" color="#ec4899" isSelected={selectedPipeline === 'explanation_why'} />
                                <PipelineCard id="explanation_how" title="EXPL_HOW" emoji="üîß" color="#8b5cf6" isSelected={selectedPipeline === 'explanation_how'} />
                            </div>

                            {selectedPipeline && (
                                <div 
                                    className="rounded-xl p-5 mb-6"
                                    style={{ backgroundColor: `${pipelineDetails[selectedPipeline].color}10`, borderLeft: `4px solid ${pipelineDetails[selectedPipeline].color}` }}
                                >
                                    <h3 className="font-bold text-lg mb-1" style={{ color: pipelineDetails[selectedPipeline].color }}>
                                        {pipelineDetails[selectedPipeline].title}
                                    </h3>
                                    <p className="text-slate-500 italic text-sm mb-4">{pipelineDetails[selectedPipeline].example}</p>
                                    
                                    <div className="text-xs font-semibold text-slate-500 uppercase mb-2">Re-ranking Steps:</div>
                                    <div className="space-y-2">
                                        {pipelineDetails[selectedPipeline].steps.map((step, idx) => (
                                            <div key={idx} className="bg-white rounded-lg p-3 shadow-sm flex gap-3">
                                                <div className="w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold" style={{ backgroundColor: pipelineDetails[selectedPipeline].color }}>
                                                    {idx + 1}
                                                </div>
                                                <div>
                                                    <div className="font-semibold text-slate-800 text-sm">{step.name}</div>
                                                    <div className="text-xs text-slate-400 font-mono">{step.tech}</div>
                                                    <div className="text-xs text-slate-600 mt-1 whitespace-pre-line">{step.detail}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            <Arrow />

                            <Box className="bg-indigo-50 border-2 border-indigo-400 max-w-md mx-auto text-center">
                                <div className="text-sm font-semibold text-indigo-700">üì§ RANKED RESULTS</div>
                                <div className="text-slate-600 text-xs mt-1">Top-K optimized for query intent</div>
                            </Box>
                        </div>

                        <p className="text-center text-slate-400 text-xs mt-6">FiQA Intent-Aware Retrieval ¬∑ IR Course 2024</p>
                    </div>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<MethodologyDiagram />);
    </script>
</body>
</html>
